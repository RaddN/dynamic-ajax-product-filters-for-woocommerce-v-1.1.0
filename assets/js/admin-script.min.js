if (document.getElementById("custom_template_input")) {
    // Get WordPress CodeMirror settings
    const editorSettings = wp.codeEditor.defaultSettings.codemirror;

    // Override some settings
    editorSettings.mode = 'text/html';
    editorSettings.lineNumbers = true;
    editorSettings.lineWrapping = true;

    // Initialize the editor
    const editor = wp.codeEditor.initialize(document.getElementById("custom_template_input"), {
        codemirror: editorSettings
    }).codemirror;

    // Your existing change handler
    editor.on("change", function () {
        document.getElementById("custom_template_input").value = editor.getValue();
    });

    // Your placeholder insertion function
    function insertPlaceholder(placeholder) {
        const cursor = editor.getCursor();
        editor.replaceRange(placeholder, cursor);
        editor.focus();
    }
}

// form manage script show & hide custom template
document.addEventListener("DOMContentLoaded", function () {
    const checkbox = document.querySelector('input[name="dapfforwc_options[use_custom_template]"]');

    // Function to show or hide the closest <tr> with the .custom_template_code class
    function toggleTemplateRow() {
        let closestTr = document.querySelector(".custom_template_code");

        if (closestTr) { closestTr = closestTr.closest('tr'); }

        // Check if the next sibling has the class 'custom_template_code'
        if (closestTr) {
            if (checkbox.checked) {
                closestTr.style.display = ''; // Show the row
            } else {
                closestTr.style.display = 'none'; // Hide the row
            }
        }
    }
    // Event listener for checkbox change
    if (checkbox) {
        checkbox.addEventListener('change', toggleTemplateRow);
    }

    // Initialize the state on page load
    toggleTemplateRow();
});

// loading effect popup
document.addEventListener('DOMContentLoaded', function () {
    const customizeLoaderLink = document.getElementById('customize_loader');
    const popup = document.getElementById('custom-loading-popup');
    const closePopup = document.querySelector('.close-popup');
    const saveEffectButton = document.getElementById('save-effect');
    let selectedEffect = null;

    if (customizeLoaderLink) {
        customizeLoaderLink.addEventListener('click', function (e) {
            e.preventDefault();
            popup.style.display = 'flex';
        });
    }

    if (closePopup) {
        closePopup.addEventListener('click', function () {
            popup.style.display = 'none';
        });
    }

    document.querySelectorAll('.loading-option').forEach(option => {
        option.addEventListener('click', function () {
            const html = this.getAttribute('data-html');
            const css = this.getAttribute('data-css');
            document.getElementById('loader_html').value = html;
            document.getElementById('loader_css').value = css;
            // Remove selected class from all options
            document.querySelectorAll('.loading-option').forEach(opt => opt.classList.remove('selected'));
            // Add selected class to the clicked option
            this.classList.add('selected');
            // Store the selected effect value
            selectedEffect = this.getAttribute('data-value');
        });
    });
});



document.addEventListener('DOMContentLoaded', function () {
    const checkbox = document.querySelector('input[name="dapfforwc_seo_permalinks_options[enable_seo]"]');
    const secondTable = document.querySelectorAll('table.form-table')[1];

    function toggleInputs() {
        if (!secondTable) return;
        const inputsAndSelects = secondTable.querySelectorAll('select');
        const isChecked = checkbox.checked;

        inputsAndSelects.forEach(input => {
            input.disabled = !isChecked;
        });
    }

    // Initial check
    if (secondTable && checkbox) {
        toggleInputs();
        // Listen for changes
        checkbox.addEventListener('change', toggleInputs);
    }
});


jQuery(document).ready(function ($) {
    // Initialize Select2 on all select elements with the class 'plugincy_select2'
    $('.plugincy_select2').select2({
        placeholder: function () {
            return $(this).data('placeholder');
        },
        width: 'resolve',
        allowClear: true,
    });
});



function copyToClipboard(event, shortcode) {
    const shortcodeText = shortcode;
    const button = event.currentTarget;
    const buttonText = (button && typeof button.querySelector === 'function') ? button.querySelector('.btn-text') : null;
    const originalText = buttonText ? buttonText.textContent : '';

    // Fallback function for older browsers
    function fallbackCopy(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
            document.execCommand('copy');
            textArea.remove();
            return true;
        } catch (err) {
            console.error('Fallback: Could not copy text', err);
            textArea.remove();
            return false;
        }
    }

    // Try modern clipboard API first, fallback to execCommand
    const copyPromise = navigator.clipboard && navigator.clipboard.writeText ?
        navigator.clipboard.writeText(shortcodeText) :
        Promise.resolve(fallbackCopy(shortcodeText));

    copyPromise.then(() => {
        button.classList.add('copied');
        if (originalText) {
            button.innerHTML = `
                    <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    <span class="btn-text">Copied!</span>
                `;
        } else {
            button.innerHTML = `
                    <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                `;
        }

        setTimeout(() => {
            button.classList.remove('copied');
            button.innerHTML = `
                        <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        <span class="btn-text">${originalText}</span>
                    `;
        }, 2000);
    }).catch(err => {
        console.error('Failed to copy:', err);
        alert('Failed to copy. Please select and copy manually.');
    });
}

